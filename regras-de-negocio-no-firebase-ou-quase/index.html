<!DOCTYPE html><html ⚡ lang="pt-br"><head><meta charset="utf-8"><link rel="manifest" href="/manifest.json"><script async src="https://cdn.ampproject.org/v0.js"></script><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Regras de negócio no Firebase (ou quase) · Joselito</title><link rel="canonical" href="https://joseli.to/regras-de-negocio-no-firebase-ou-quase/"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="description" content="Porque ele é mais do que um Banco de Dados que atualiza sozinho.O Firebase é poderoso e acho que todo mundo hoje em dia está de acordo com isso. A versão 3.0 mostrou que não tá aí de brincadeira e já"><meta name="keywords" content="Código,firebase"><meta property="og:type" content="article"><meta property="og:title" content="Regras de negócio no Firebase (ou quase)"><meta property="og:url" content="https://joseli.to/regras-de-negocio-no-firebase-ou-quase/index.html"><meta property="og:site_name" content="Joselito"><meta property="og:description" content="Porque ele é mais do que um Banco de Dados que atualiza sozinho.O Firebase é poderoso e acho que todo mundo hoje em dia está de acordo com isso. A versão 3.0 mostrou que não tá aí de brincadeira e já"><meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/1*mSfaQfUwDFCFyKPvFYEHOw.jpeg"><meta property="og:image" content="https://cdn-images-1.medium.com/max/720/1*8yM-gC7g_fsX8ULyFZZebQ.jpeg"><meta property="og:image" content="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=792739ca9279"><meta property="og:updated_time" content="2017-06-03T02:44:33.577Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Regras de negócio no Firebase (ou quase)"><meta name="twitter:description" content="Porque ele é mais do que um Banco de Dados que atualiza sozinho.O Firebase é poderoso e acho que todo mundo hoje em dia está de acordo com isso. A versão 3.0 mostrou que não tá aí de brincadeira e já"><meta name="twitter:image" content="https://cdn-images-1.medium.com/max/1024/1*mSfaQfUwDFCFyKPvFYEHOw.jpeg"><meta property="fb:app_id" content="1265807416816197"><meta property="fb:pages" content="191984887960659"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/icon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/icon-512x512.png"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="application-name" content="Joselito"><meta name="apple-mobile-web-app-title" content="Joselito"><meta name="theme-color" content="#0000ff"><meta name="msapplication-navbutton-color" content="#0000ff"><meta name="apple-mobile-web-app-status-bar-style" content="#0000ff"><meta name="msapplication-starturl" content="/"><meta name="twitter:site" content="@joselitojunior1"><meta name="twitter:creator" content="@joselitojunior1"><meta property="og:image" content="https://joseli.to/images/share/fb.png"><meta name="twitter:image:src" content="https://joseli.to/images/share/twitter.png"><link rel="alternate" href="/rss.xml" title="Regras de negócio no Firebase (ou quase) · Joselito" type="application/rss+xml"><link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet"><style amp-boilerplate="">body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate="">body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom="">/*! Bassplate | MIT License | http://github.com/basscss/bassplate, normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */@keyframes BackgroundAnimation{0%{background-position:0 99%}50%{background-position:100% 2%}100%{background-position:0 99%}}button{overflow:visible}.list-reset{list-style:none}html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100}body{margin:0}article,footer,header,section{display:block}h1{font-size:2em;margin:.67em 0}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}strong{font-weight:inherit;font-weight:bolder}small{font-size:80%}img{border-style:none}button{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button{text-transform:none}button{-webkit-appearance:button}button::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring{outline:ButtonText dotted 1px}.list-reset{padding-left:0}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}.h2{font-size:2rem}.text-decoration-none{text-decoration:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.m0{margin:0}.mr1{margin-right:.5rem}.mr2{margin-right:1rem}.mb2{margin-bottom:1rem}.mx-auto{margin-left:auto}.mx-auto{margin-right:auto}.pl2,.px2{padding-left:1rem}.px2{padding-right:1rem}.px3{padding-left:1.5rem}.pr3,.px3{padding-right:1.5rem}.flex{display:-webkit-box;display:-ms-flexbox;display:flex}@media (min-width:40.06rem){.sm-col-12{width:100%}}@media (min-width:52.06rem){.md-col-10{width:83.33333%}}@media (min-width:64.06rem){.lg-col-8{width:66.66667%}.lg-hide{display:none}}.items-start{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.items-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.justify-start{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.justify-between{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.fixed{position:fixed}.top-0{top:0}.right-0{right:0}.left-0{left:0}@media (max-width:40rem){.xs-hide{display:none}}@media (min-width:40.06rem) and (max-width:52rem){.sm-hide{display:none}}@media (min-width:52.06rem) and (max-width:64rem){.md-hide{display:none}}*{box-sizing:border-box}body{background:#fff;color:#4a4a4a;line-height:1.5rem;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,Arial,sans-serif;min-width:315px;overflow-x:hidden;font-smooth:always;-webkit-font-smoothing:antialiased}p{padding:0;margin:0}body{font-family:'Space Mono',Consolas,monospace;line-height:1.618}.post header{margin:0}.header-title{display:block;margin:1.2rem 0;max-height:50px}.posttitle{font-weight:700;margin:0 0 .75rem;font-size:2.5rem}.main{margin:2rem auto}.main section{margin-bottom:2.5rem}a,a:visited{color:#00f;font-weight:700;text-decoration:none}header a,header a:visited{color:#fff;text-transform:uppercase}.clear-list{margin:0;padding:0}.clear-list li{list-style:none}.inline-list li{display:inline-block}.content p{margin-bottom:1.5rem}.meta{display:inline-block}.afo-headerbar{color:#fff;z-index:999;min-height:4rem;background:linear-gradient(270deg,#00f,#8a2be2);background-size:200% 200%;animation:BackgroundAnimation 60s ease infinite}.afo-headerbar+amp-sidebar+*{margin-top:8rem}.afo-navbar-trigger{font-size:2.25rem}.afo-sidebar{width:60vw;margin:0;padding:10px 20px;background:#fff}li.afo-nav-item{margin:1rem 0;text-transform:uppercase}.custom-share-icon{background-color:#00f;border:10px solid transparent;margin:.25rem .5rem 0 0}.poster-footer{margin:1rem 0}.lw{text-transform:lowercase}.keep-reading,footer{margin:1rem 0 0}.article-share-pls{max-width:600px}</style><script async custom-element="amp-install-serviceworker" src="https://cdn.ampproject.org/v0/amp-install-serviceworker-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-facebook-comments" src="https://cdn.ampproject.org/v0/amp-facebook-comments-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script></head><body><header class="afo-headerbar fixed flex justify-between items-center top-0 left-0 right-0 pl2 pr3"><div><a href="/" class="header-title"><amp-img src="/images/logo.svg" alt="Welcome" height="50" width="100"></amp-img></a></div><div role="button" on="tap:header-sidebar.toggle" tabindex="0" class="afo-navbar-trigger md-hide lg-hide sm-hide">[≡]</div><ul class="inline-list xs-hide"><li class="afo-headerbar-item mr1">[<a href="https://sininho.joseli.to" class="text-decoration-none">🔔 Notificações</a>]</li><li class="afo-headerbar-item mr1">[<a href="/sobre/" class="text-decoration-none">Sobre</a>]</li><li class="afo-headerbar-item mr1">[<a href="/arquivos/" class="text-decoration-none">Artigos</a>]</li><li class="afo-headerbar-item mr1">[<a href="https://codelabs.joseli.to" class="text-decoration-none">Codelabs</a>]</li><li class="afo-headerbar-item mr1">[<a href="/palestras/" class="text-decoration-none">Palestras</a>]</li></ul></header><amp-sidebar id="header-sidebar" class="afo-sidebar px3" layout="nodisplay"><div class="flex justify-start items-center"><div role="button" on="tap:header-sidebar.toggle" tabindex="0" class="afo-navbar-trigger items-start">✕</div></div><ul class="list-reset m0"><li class="afo-nav-item"><a href="https://sininho.joseli.to" class="text-decoration-none">🔔 Notificações</a></li><li class="afo-nav-item"><a href="/sobre/" class="text-decoration-none">Sobre</a></li><li class="afo-nav-item"><a href="/arquivos/" class="text-decoration-none">Artigos</a></li><li class="afo-nav-item"><a href="https://codelabs.joseli.to" class="text-decoration-none">Codelabs</a></li><li class="afo-nav-item"><a href="/palestras/" class="text-decoration-none">Palestras</a></li></ul></amp-sidebar><div class="clearfix main"><div class="sm-col-12 md-col-10 lg-col-8 px2 mx-auto"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><div class="postdate mr2">📅 <time datetime="2016-09-29T05:07:26.000Z" itemprop="datePublished">2016-09-29</time></div><div>🕑 6 min</div><h1 class="posttitle" itemprop="name headline">Regras de negócio no Firebase (ou quase)</h1><div class="meta"><div class="article-tag"><a class="tag-link" href="/tags/codigo/">Código</a> <a class="tag-link" href="/tags/firebase/">firebase</a></div></div></header><div id="toc-footer"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#E-tudo-JavaScript-mesmo"><span class="toc-number">1.</span> <span class="toc-text">É tudo JavaScript mesmo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mais-que-autenticacao"><span class="toc-number">2.</span> <span class="toc-text">Mais que autenticação</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Valide-Eu-validaria"><span class="toc-number">3.</span> <span class="toc-text">Valide. Eu validaria.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Esta-bom-por-hoje"><span class="toc-number">4.</span> <span class="toc-text">Está bom por hoje</span></a></li></ol></div><div class="content" itemprop="articleBody"><p><em>Porque ele é mais do que um Banco de Dados que atualiza sozinho.</em></p><figure><img src="https://cdn-images-1.medium.com/max/1024/1*mSfaQfUwDFCFyKPvFYEHOw.jpeg" alt=""></figure><p>O <strong>Firebase </strong>é poderoso e acho que todo mundo hoje em dia está de acordo com isso. A versão 3.0 mostrou que não tá aí de brincadeira e já tem uma <a href="https://firebase.google.com/customers" target="_blank" rel="external">galera topster</a> usando em produção.</p><p>Mas se tem uma coisa confusa sobre o Firebase é sobre como a sua segurança e regras funcionam. Quem tá acostumado com um CRUD clássico, onde ele escreve as regras e validações antes daquele conteúdo que o usuário criou ir pra o banco de dados.</p><p>Alguns acham que a validação e implementação de regras de segurança devem ser do lado do <strong><em>frontend</em></strong>. Mais absurdo que isso, apenas aqueles que acham que o <strong>Firebase </strong>não faz qualquer verificação, e qualquer um que conseguir o conjunto de chaves vai pintar e bordar com seu <em>backend</em>.</p><p>Trago boas novas. É compreensível a dúvida já que praticamente todo conteúdo que existe sobre <strong>Firebase </strong>é demonstrando como fazer _get _e _set _de variável, e mostrando como é fofinho mudando os valores em tempo real. Quantas vezes eu não ouvi que o Firebase é top pra fazer um <strong>Dashboardzinho</strong>, mas pra projeto “<em>de verdade</em>” precisa de banco de dados “<em>de verdade</em>”. Parece até um eleitor do Trump falando (ou talvez do Dória).</p><p>Vem conhecer o <strong>Firebase Rules.</strong><span id="more-11"></span></p><figure><img src="https://cdn-images-1.medium.com/max/720/1*8yM-gC7g_fsX8ULyFZZebQ.jpeg" alt=""><figcaption>João Dória comendo coisas. Sem motivo.</figcaption></figure><h4 id="E-tudo-JavaScript-mesmo"><a href="#E-tudo-JavaScript-mesmo" class="headerlink" title="É tudo JavaScript mesmo"></a>É tudo JavaScript mesmo</h4><p>O Firebase Rules se utiliza de uma sintaxe própria para descrever as regras. Tal qual o próprio banco de dados, ele é um arquivo JSON enorme, onde usamos determinadas variáveis na estrutura de dados.</p><p>No seu console, vá em <strong>Database </strong>no menu lateral e clique na aba <strong>Rules</strong>. Logo quando você cria um projeto no Firebase, ele vai vir assim:</p><pre>{ 
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null"
  }
}</pre><p><em>“rules”</em> é nosso objeto raiz, equivalente ao objeto raiz do banco. Tudo que estiver abaixo dele em hierarquia vai ser correspondido ao objeto no banco do Firebase.</p><p>Além disso, repare nas primeiras palavras reservadas que temos: <em>“.read”</em> e <em>“.write”</em>. É isso mesmo que você tá pensando: <em>.read</em> define as regras de leitura e <em>.write</em> define as regras de escrita. Perceba também que a informação recebida sempre é uma <strong>expressão que retorna um booleano</strong>.</p><p>Ou seja, toda vez que alguma operação for realizada no banco de dados, o Firebase vai lá nas Rules ver quais são as regras aplicadas a aquele objeto, rodar a verificação e ver se ela passa ou não.</p><blockquote><p>Ok. Top. Mas como ele sabe quem foi que fez essa operação pra saber se ela vai ser válida?</p></blockquote><p>Excelente pergunta. O código acima basicamente está dizendo que para ler e escrever, o usuário precisa estar autenticado. <em>“auth”</em> é mais uma palavra reservada do Firebase, sendo esta uma representação do objeto de autenticação do usuário que está fazendo determinada requisição. Se _auth _não é null, então isso significa que o usuário está logado.</p><p>**E se eu quiser que todo mundo tenha acesso?</p><p>**Fácil. É só fazer algo mais ou menos assim:</p><pre>{ 
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null",
    "public": {
        ".read": true,
        ".write": true
    }
  }
}</pre><p>Como sempre é retornado um valor booleano, o que estamos querendo dizer acima é que, o que está dentro do objeto “public” é acessível para leitura e escrita para qualquer pessoa que esteja acessando sua aplicação. Isso é maravilhoso e terrível se você souber (ou não) o que está fazendo.</p><h4 id="Mais-que-autenticacao"><a href="#Mais-que-autenticacao" class="headerlink" title="Mais que autenticação"></a>Mais que autenticação</h4><p>Usamos o _auth _como exemplo geral para verificar a segurança das coisas. Mas há outras formas de verificar sem utiliza-lo (ou utilizando ele em conjunto).</p><p>Por exemplo, você quer escrever um dado uma vez, e apenas uma vez, no banco. Ele pode até ser apagado, mas não pode ser sobrescrito. É só fazer algo assim:</p><pre>".write": "!data.exists() || !newData.exists()"</pre><p>Aqui conhecemos mais duas palavras reservadas: _data _e <em>newData</em>. O _data _representa o objeto que armazena o valor atual do nó. De maneira análoga, _newData _serve para representar o valor futuro do nó, caso a operação realmente se concretize, passando na validação.</p><h4 id="Valide-Eu-validaria"><a href="#Valide-Eu-validaria" class="headerlink" title="Valide. Eu validaria."></a>Valide. Eu validaria.</h4><p>Por fim, mas não menos importante, temos o <em>“.validate”</em>, que funciona de forma parecida tal qual nossos conhecidos <em>“.read”</em> e <em>“.write”</em>. Como você bem adivinhou, ele serve para verificar se o conteúdo é valido conforme as suas regras.</p><p>Se você tá fazendo seu próprio Twitter e quer ter certeza que o usuário não vai digitar mais de 140 caracteres, faça isso aqui:</p><pre>".validate": "newData.val().length &lt;= 140"</pre><p>Quer validar se o usuário tá mandando um número, por exemplo? Mole.</p><pre>".validate": "newData.isNumber()"</pre><h4 id="Esta-bom-por-hoje"><a href="#Esta-bom-por-hoje" class="headerlink" title="Está bom por hoje"></a>Está bom por hoje</h4><p>Espero que você tenha entendido o básico do básico de segurança e validação do <strong>Firebase</strong>. Se você quer que eu faça uma versão mais avançada, aperta no coraçãozinho aqui no <strong>Medium </strong>e compartilha com o pessoal. Aí eu sei o conteúdo é legal e que vocês querem saber mais sobre (:</p><p>Hora de acabar com esse <a href="https://www.youtube.com/watch?v=Jzl_nrTkfIM" target="_blank" rel="external">medo bobo</a> de usar o Firebase.<img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=792739ca9279" alt=""></p></div></article><section id="recadinhos"><span class="h2">Recadinhos <span role="img" aria-label="fire">🔥</span></span><ul class="recadinhos-list clear-list"><li class="recadinhos-item">[<a href="http://pwa.press">PWA Press</a>] Conheça meu novo Newsletter quinzenal sobre Progressive Web Apps!</li><li class="recadinhos-item">[<a href="https://events.withgoogle.com/google-launchpad-build-recife-12-de-agosto/">Google Launchpad Build Recife</a>] Vai ter talk minha no Launchpad Build Recife sobre Progressive Web Apps, inscreva-se grátis!</li><li class="recadinhos-item">[<a href="https://joseli.to">Updates no blog</a>] Dei uma tapa no visual com umas fontes mais bonitinhas, melhor responsividade e o melhor domínio possivel</li><li class="recadinhos-item">[<a href="http://youtube.com/c/joselitojunior">JOSE2</a>] Inscreva-se no meu canal no YouTube</li><li class="recadinhos-item">[<a href="http://fb.com/joselitobot">Josebot</a>] Curta minha fanpage e fale com meu bot no Facebook</li></ul></section><div class="poster-footer"><div class="article-share-pls mb2"><strong>Você gostou desse artigo? Então compartilhe!</strong><p>Esse é o melhor jeito de eu saber qual o assunto vocês estão mais interessados e me motiva a escrever mais!</p><div><amp-social-share type="twitter" class="custom-share-icon" width="50" height="50"></amp-social-share><amp-social-share type="facebook" data-param-app_id="254325784911610" class="custom-share-icon" width="50" height="50"></amp-social-share><amp-social-share type="linkedin" class="custom-share-icon" width="50" height="50"></amp-social-share><amp-social-share type="whatsapp" class="custom-share-icon sm-hide md-hide lg-hide" width="50" height="50"></amp-social-share><amp-social-share type="email" class="custom-share-icon" width="50" height="50"></amp-social-share></div></div><div class="lw">[📝 <a href="https://github.com/joselitojunior1/joseli.to/edit/master/source/_posts/regras-de-negocio-no-firebase-ou-quase.md">Edite esse artigo no GitHub</a>] [🔔 <a href="https://sininho.joseli.to">Ative as Notificações</a>]</div></div><amp-facebook-comments width="600" height="280" layout="responsive" data-numposts="5" data-href="https://joseli.to/regras-de-negocio-no-firebase-ou-quase/"></amp-facebook-comments><div class="keep-reading lw"><strong>Continue lendo:</strong><ul class="inline-list clear-list"><li>[⇦ <a href="/fira-code-a-fonte-perfeita-pra-voce-codar/">Fira Code: a fonte perfeita pra você codar</a>]</li><li>[<a href="/o-ionic-2-rc-saiu-seu-app-acabou-de-quebrar-de-novo/">O Ionic 2 RC saiu! Seu @App acabou de quebrar (de novo)!</a> ⇨]</li></ul></div><footer id="footer"><div class="mecenas lw"><strong>Mecenas:</strong> [<a href="https://joselito.pw/_digitalocean">Digital Ocean</a>] [<a href="https://joselito.pw/_umbler">Umbler</a>] [<a href="https://joselito.pw/_booking">Booking</a>] [<a href="https://joselito.pw/_ebanx">Ebanx</a>]</div><small>CC BY-SA &copy; 2017 Joselito Júnior</small></footer></div></div><amp-install-serviceworker src="/sw.js" data-iframe-src="/sw.html" layout="nodisplay"></amp-install-serviceworker><amp-analytics type="clicky"><script type="application/json">{"vars": {"site_id": "101052603"}}</script></amp-analytics></body></html>